{
   "name":{{cluster.name}},
   "description":{{cluster.description}},
   "vxnet":{{cluster.vxnet}},
   "backup_policy": "device",
   "incremental_backup_supported": true,
   "multi_zone_policy": "round_robin",
   "advanced_actions": ["change_vxnet", "scale_horizontal"],
   "upgrade_policy": [
      "appv-omli6gvn"
   ],
   "upgrading_policy": "in-place-sequential",
   "in-place-upgrade-nodes": [{
     "container":{
       "snapshot": "ss-6sl07o16",
       "zone": "pek3"
     },
     "copy":[{
       "mount_role": "replica",
       "mount_point": "/upgrade",
       "mount_options": "defaults,noatime",
       "filesystem": "ext4"
     }]
   }],
   "nodes":[
      {
         "role":"replica",
         "container":{
            "type":"kvm",
            "zone":"pek3",
            "image":"img-jvt073n6"
         },
         "instance_class":{{cluster.replica.instance_class}},
         "count":{{cluster.replica.count}},
         "cpu":{{cluster.replica.cpu}},
         "memory":{{cluster.replica.memory}},
         "volume":{
            "size":{{cluster.replica.volume_size}},
            "mount_point":"/data",
            "filesystem":"ext4"
         },
         "passphraseless":"ssh-rsa",
         "vertical_scaling_policy":"sequential",
         "services":{
            "backup": {
               "nodes_to_execute_on": 1,
               "order": 1
            },
            "init":{
               "post_start_service":true,
               "order":1,
               "cmd":"/opt/app/bin/mongo-trib.py init"
            },
            "start":{
               "cmd":"mkdir -p /data/mongodb;/opt/app/bin/start-mongod-server.sh"
            },
            "stop":{
               "cmd":"/opt/app/bin/stop-mongod-server.sh"
            },
            "restart":{
               "cmd":"/opt/app/bin/restart-mongod-server.sh"
            },
            "scale_out":{
               "nodes_to_execute_on":1,
               "order":2,
               "cmd":"/opt/app/bin/mongo-trib.py reconfig"
            },
            "scale_in":{
               "nodes_to_execute_on":1,
               "order":3,
               "cmd":"/opt/app/bin/mongo-trib.py reconfig"
            },
            "destroy":{
               "nodes_to_execute_on":1,
               "order":2,
               "cmd":"/opt/app/bin/mongo-trib.py reconfig"
            },
            "upgrade":{
               "cmd": "/upgrade/upgrade.sh",
               "timeout": 10800
            },
            "copy_log": {
                "type": "custom",
                "cmd": "/opt/app/bin/mongo-trib.py copy_log && echo finish",
                "timeout": 1800,
                "service_params": {
                    "copy_log": {{service_params.copy_log}}
                }
            },
            "clean_log": {
                "type": "custom",
                "cmd": "/opt/app/bin/mongo-trib.py clean_log",
                "timeout": 1800
            },
            "get_nodes_order": {
               "event": ["upgrade"],
               "cmd": "/upgrade/upgrade.sh getOrder"
            },
            "rollback": {
                "cmd": "if [ -f /opt/app/bin/upgrade.sh ]; then /opt/app/bin/upgrade.sh doRollback; fi"
            },
            "changeFcv": {
               "type": "custom",
               "cmd": "/opt/app/bin/helper.sh changeFcv",
               "service_params": {
                  "fcv": {{service_params.fcv}}
               }
            }
         }
      }
   ],
   "env": {
      "user": {{env.user}},
      "passwd": {{env.passwd}},
      "maxConns": {{env.maxConns}},
      "oplogSize": {{env.oplogSize}},
      "port": {{env.port}}
   },
   "advanced_services": {
      "update_nodes_names": {
         "cmd": "/opt/mongodb/bin/mongo-trib.py get_nodes_names",
         "timeout": 10
      }
   },
   "endpoints": {
      "mongod": {
         "port": {{env.port}},
         "protocol": "TCP"
      }
   },
   "health_check":{
      "enable": true,
      "interval_sec": 60,
      "timeout_sec": 30,
      "action_timeout_sec": 30,
      "healthy_threshold": 2,
      "unhealthy_threshold": 2,
      "check_cmd": "/opt/app/bin/mongo-trib.py health_check",
      "action_cmd": "/opt/app/bin/mongo-trib.py tackle"
   },
   "monitor":{
      "enable":true,
      "cmd":"/opt/app/bin/mongo-trib.py monitor",
      "items":{
         "opcounters-query":{
            "unit":"times",
            "value_type":"int",
            "statistics_type":"delta",
            "scale_factor_when_display":1
         },
         "opcounters-update":{
            "unit":"times",
            "value_type":"int",
            "statistics_type":"delta",
            "scale_factor_when_display":1
         },
         "opcountersRepl-query":{
            "unit":"times",
            "value_type":"int",
            "statistics_type":"delta",
            "scale_factor_when_display":1
         },
         "opcounters-insert":{
            "unit":"times",
            "value_type":"int",
            "statistics_type":"delta",
            "scale_factor_when_display":1
         },
         "opcounters-total":{
            "unit":"times",
            "value_type":"int",
            "statistics_type":"delta",
            "scale_factor_when_display":1
         },
         "opcountersRepl-total":{
            "unit":"times",
            "value_type":"int",
            "statistics_type":"delta",
            "scale_factor_when_display":1
         },
         "opcountersRepl-delete":{
            "unit":"times",
            "value_type":"int",
            "statistics_type":"delta",
            "scale_factor_when_display":1
         },
         "connections":{
            "unit":"times",
            "value_type":"int",
            "statistics_type":"avg",
            "scale_factor_when_display":1
         },
         "opcountersRepl-insert":{
            "unit":"times",
            "value_type":"int",
            "statistics_type":"delta",
            "scale_factor_when_display":1
         },
         "opcountersRepl-update":{
            "unit":"times",
            "value_type":"int",
            "statistics_type":"delta",
            "scale_factor_when_display":1
         },
         "opcounters-delete":{
            "unit":"times",
            "value_type":"int",
            "statistics_type":"delta",
            "scale_factor_when_display":1
         }
      },
      "groups":{
         "opcountersRepl":[
            "opcountersRepl-insert",
            "opcountersRepl-query",
            "opcountersRepl-update",
            "opcountersRepl-delete"
         ],
         "opcounters":[
            "opcounters-insert",
            "opcounters-query",
            "opcounters-update",
            "opcounters-delete"
         ]
      },
      "display":[
         "opcounters",
         "opcountersRepl",
         "connections"
      ],
      "alarm":[
         "connections"
      ]
   },
   "display_tabs": {
      "FCV": {
         "cmd": "/opt/app/bin/helper.sh showFcv",
         "description": "Feature compatibility version, can be changed through 'changeFcv' menu, please refer to [official documents](https://docs.mongodb.com/v3.6/reference/command/setFeatureCompatibilityVersion/) to get more information.<br/>Caution1: if you use 3.6 features in your database configuration, you can't downgrade to fcv 3.4 anymore!<br/>Caution2: if you upgrade your cluster from 3.4 to current version, fcv remains 3.4. Please test your server&client thoroughly before changing fcv to 3.6!"
      }
   }
}
